                                                        /////////////////MAIN STARTS////////////////////////////                                                        main();                                                        function main(){                                                         var fileSep = "/";                                                                                                                 //Where fileSep is "/" you can change it though if you are on windows.                                                        if(File.fs=="Windows")                                                        {                                                             fileSep = "\\";                                                        }                                                        ///////////TEMPLATE SELECTION DIAGLOG                                                        app.open(File(app.activeScript.parent.fsName+fileSep+'DITAnator_templates'+fileSep+'Early Foundations TG.indt'));                                                          ///////END OF DIALOG////////////////////////////////////////////////                                                                                                                                                                        //////DITANATION STARTS HERE//////////////////////////////////////                                                                                                                var myDoc = app.activeDocument;                                                        /////OPENS THE XML FILE////////////////////////////////                                                                                                                  var myFile = '';                                                        try{                                                          function maskFile(myFile) {                                                          if (myFile.constructor.name == "Folder") { return true }                                                          if (myFile.name.slice(-4) == ".xml") { return true }                                                          return false;                                                          }                                                          var myFile = File.openDialog("GET YOUR XML FILE", maskFile);                                                          var myXML = myDoc.importXML(myFile);                                                          myXML;                                                          }                                                         catch(e){ exit();                                                         };                                                        ///////////////MY GLOBAL XML VARIABLES///////////////////////////////////////////////                                                         var xml = myDoc.xmlElements[0];                                                         //////*****MAKES XPATH HAPPY AND COOPERATIVE*****////////////////////////////////////                                                        if( !xml.xmlAttributes.itemByName("xmlns:xml").isValid )                                                        xml.xmlAttributes.add( "xmlns:xml", "http://www.w3.org/XML/1998/namespace" );                                                        if( !xml.xmlAttributes.itemByName("xmlns:aid").isValid )                                                        xml.xmlAttributes.add( "xmlns:aid", "http://ns.adobe.com/Adobe InDesign/4.0/" );                                                        if( !xml.xmlAttributes.itemByName("xmlns:aid5").isValid )                                                        xml.xmlAttributes.add( "xmlns:aid5", "http://ns.adobe.com/Adobe InDesign/5.0/" );                                                        /////////////////////////////////////////////////////////////////////////////////////////////                                                           var pageNode= xml.evaluateXPathExpression("//page");                                                       var maxPage =0;                                                       var minPage = pageNode[0].xmlAttributes.item("value").value;                                                       var myContent = xml.evaluateXPathExpression("//*[contains(@class,' topic/topic ')]");                                                       var bookTitle = xml.evaluateXPathExpression('//mainpubtitle');                                                       var bookMeta = xml.evaluateXPathExpression('//data');                                                       var myChapter = xml.evaluateXPathExpression('//chapter');                                                       /////////SET THE START PAGE NUMBER/////////////////////////////////////////////////////////                                                       myDoc.documentPreferences.startPageNumber  = parseInt(minPage);                                                       /////////GET THE XML IN//////////////////////////////////////////////////////////////////                                                       ////////chapters first////////////////////////////////////////////////////////////////////////////                                                       try{                                                       for(c = 0; c < myChapter.length; c++){                                                       var chapterPage = myChapter[c].xmlElements.item('topicref').xmlElements.item('concept').xmlElements.item('conbody').xmlElements.item('page').xmlAttributes.item('value').value;//~                                                        alert(chapterPage[0]);                                                       var chapterPage = chapterPage[0];                                                       var chapterLabel = myChapter[c].xmlAttributes.item('outputclass').value;                                                       var chapterFrames = myDoc.pages[parseInt(chapterPage)-1].textFrames.everyItem().getElements();                                                       for(f = 0; f < chapterFrames.length; f++){                                                        if(chapterLabel == chapterFrames[f].label){                                                            myChapter[c].placeXML(chapterFrames[f]);                                                           }                                                           }                                                           }                                                           }                                                           catch(e){}                                                       /////////////////////////////////////////////////////////////////////////////////////////////////                                                        var allTextFrames = toArray(myDoc.textFrames);                                                        var bodyTextFrames = selectWhere("body_content", "label", allTextFrames);                                                        var sidebarTextFrames = selectWhere("sidebar_content", "label", allTextFrames);                                                            for(x=0;x < Math.min(allTextFrames.length, myContent.length) ;x++){                                                            try{                                                                //var type1= ditas[x].xmlAttributes.itemByName("outputclass").value;                                                                allTextFrames[x].name = allTextFrames[x].label;//~                                                                 alert(allTextFrames[x].name)                                                                var type= myContent[x].xmlAttributes.itemByName("outputclass").value;                                                                                                            //alert(type);                                                                var page = pageNode[x].xmlAttributes.item("value").value;                                                                //var label = allTextFrames[x].label;                                                                //alert(page);                                                                }                                                                catch(e){                                                                    }                                                                try{                                                                    if(type == type)                                                                    {                                                                      var pageBodyTextFrames = selectWhere(type, "label", myDoc.pages[page-parseInt(minPage)].textFrames);                                                                          }                                                               else                                                                    {                                                                var pageBodyTextFrames = selectWhere("body_content", "label", myDoc.pages[page-parseInt(minPage)].textFrames);                                                                    }                                                                var newTextFrame = pageBodyTextFrames[0];                                                                myContent[x].placeXML(newTextFrame);                                                                ///meta/////                                                                }                                                                catch(e){                                                                    }                                                                }                                                                /////////POURS EVERYTHING ELSE THAT IS NOT ON THE TEMPLATE/////////////////////////////////////////////////////////////                                                                                                                for (i = 0; i < pageNode.length; i++){                                                         try{                                                        if(myContent[i].xmlContent.parent.name==""){                                                        var page = pageNode[i].xmlAttributes.item("value").value;                                                        //alert(page);                                                        var nodeLabel = myContent[i].xmlAttributes.itemByName("outputclass").value;                                                        myContent[i].placeXML(addTextFrame(myDoc.pages[page-parseInt(minPage)], nodeLabel))                                                        }                                                        }                                                        catch(e){}                                                        }                                                        /////RE IMPORTS THE XML FILE FOR PROPER STYLING/////////////////////////////////                                                       myDoc.importXML(myFile);                                                                                                                  /////RUNS TABLENATOR FOR PROPER TABLE WIDTH AND NO EXTRA RETURNS INSIDE TABLES/////////////////////////////////                                                         try{                                                         app.doScript(new File(app.activeScript.parent.fsName+fileSep+"Tablenator.jsx"), ScriptLanguage.javascript);//~                                                          app.doScript(new File(app.activeScript.parent.fsName+fileSep+"Warhol.jsx"), ScriptLanguage.javascript);//~                                                          app.doScript(new File(app.activeScript.parent.fsName+fileSep+"Technicolor.jsx"), ScriptLanguage.javascript);                                                          }                                                          catch(e){}                                                                                                        //-----Pub Meta-----//                                                                    try{                                                          for(m = 0; m < bookMeta.length; m++){                                                        var dataName = bookMeta[m].xmlAttributes.item('name').value                                                        var dataValue = bookMeta[m].xmlAttributes.item('value').value//~                                                         alert(dataName+' '+dataValue)                                                                                                                var dataFrames = myDoc.pages[0].textFrames.everyItem().getElements();                                                        for(d = 0; d < dataFrames.length; d++){                                                            if(dataFrames[d].label == 'metadata'){                                                                dataFrames[d].insertionPoints[-1].contents = dataName+': '+dataValue+'\r';                                                                }                                                           }                                                        }                                                    }                                                catch(e){}                                                try{                                                    for(t = 0; t < bookTitle.length; t++){                                                        var dataFrames = myDoc.pages[0].textFrames.everyItem().getElements();                                                        for(d = 0; d < dataFrames.length; d++){                                                        if(dataFrames[d].label=='book_title'){                                                            dataFrames[d].insertionPoints[0].contents = bookTitle[t].xmlContent.contents;}                                                                                                                        }                                                        }                                                    }                                                catch(e){}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ////END OF SCRIPT//////////////////////////////////////////////////////////////////////////////////////////////////////                                                            }                                                     /////MY FUNCTIONS/////////////////////////////////////////////////////////////////////////////////////////////////////                                                                function addTextFrame(page, script_label){                                                                                                                          var pos  = -4 +" in";                                                                  var hand = page.side                                                                if (hand == PageSideOptions.LEFT_HAND)                                                                         pos = -4 +" in";  ;                                                                if (hand == PageSideOptions.RIGHT_HAND)                                                                         pos = 20 +" in";                                                                      if (page.name == 1)                                                                         pos = -4 +" in";                                                                                                                  var textFrame = page.textFrames.add({geometricBounds:[0, 0, 8 + ' in', 3 + ' in']});                                                                textFrame.move( [pos , 0 ] );                                                                textFrame.label = script_label;                                                                return textFrame;                                                                }                                                                                                                              function selectWhere(value, key, array){                                                                var i = array.length; var t; var filtered = [];                                                                    while(i--){                                                                    t = array[i];                                                                        if(t && t[key] == value && t.contents==0){                                                                            filtered.push(t);                                                                 }                                                                 }                                                                    return filtered;                                                                }                                                            function toArray(objects){                                                                var i = objects.length;                                                                 var array = [];                                                                while(i--){                                                                        array.push(objects[i]);                                                                }                                                                return array;                                                            }                                                            function countTheseElements(xmlfrag, xpath){                                                            var c = 0;                                                            for(x=0; x < xmlfrag.length;x++)                                                                {                                                                    $.writeln(xmlfrag[x].xmlElement[0].length);                                                                                                                                        }                                                     };